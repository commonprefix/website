{{define "head"}}
<style>
	/* section spacing */
	.team__section { margin: 3rem 0 2rem; }
	.team__section h2 { margin-bottom: 1.25rem; }
	.team__filters { margin-bottom: 2rem; }
	.team__filters .filter { cursor: pointer; }
	.team__filters [data-filter="department"] .dropdown { width: 160px; }

	/* subtitle for leadership */
	.team-member__name { margin-bottom: .15rem; }
	.role-line{
	margin-top: .1rem;
	font-size: .95rem;
	font-weight: 500;
	color: #444;
	letter-spacing: .02em;
	}
	section#leadership .role-line{ color:#333; }

	/* ensure hidden stays hidden */
	.team-member[hidden] { display:none !important; }
</style>
{{end}}
{{define "content"}}
<main>
	<section>
		<h1>Meet the team</h1>
		<p>
			We are a team of scientists and engineers
            researching and implementing blockchain protocols.
		</p>
	</section>

<!-- Filter bar â€“ shares research__filters styling -->
<section>
	<div class="team__filters research__filters">
		<p>Filter</p>
		<div class="filter" data-filter="department">
			<span>Department</span>
			<span hidden class="value"></span>
			<button hidden title="Clear this filter.">x</button>
			
			<div class="dropdown" hidden>
				{{range .DeptOrder}}
					<button title="Filter by this department.">{{.}}</button>
				{{end}}
			</div>
		</div>

		<button class="clear-all" hidden>Clear filter</button>
	</div>
</section>

{{/* Sectioned rendering by fixed order */}}
{{range .DeptOrder}}
  {{ $dept := . }}
  {{ $members := index $.Grouped $dept }}
  {{ if $members }}
    <section class="team__section" id="{{$dept}}" data-dept="{{$dept}}">
      <h2>
        {{- if eq $dept "leadership" -}}Leadership
        {{- else if eq $dept "engineering" -}}Engineering
        {{- else if eq $dept "science" -}}Science
        {{- else -}}Operations{{- end -}}
      </h2>

      {{range $members}}
      <div class="team-member" id="{{.Handle}}" data-dept="{{.Department}}">
        <img loading="lazy" draggable="false"
             src="/static/team/{{.Image}}" alt="{{.Name}}"
             width="280" height="280" />
        <div>
          <div class="team-member__summary">
            <img loading="lazy" draggable="false"
                 src="/static/team/{{.Image}}" alt="{{.Name}}"
                 width="130" height="130" />
            <div>
              <h2 class="team-member__name">
                {{.Name}}
                {{with index $.Titles .Handle}}<div class="role-line">{{.}}</div>{{end}}
              </h2>
              <h4 class="label">{{.Specialization}}</h4>
            </div>
          </div>
          <p>{{.Desc}}</p>
        </div>
      </div>
      {{end}}
    </section>
  {{end}}

{{end}}

</main>

<script>
(() => {
  // Filter by departments (Leadership/Engineering/Science/Operations), instead of individual cards
  const sections = document.querySelectorAll('.team__section');           // each dept section
  const chip     = document.querySelector('[data-filter="department"]');  // filter chip
  const clearAll = document.querySelector('.clear-all');                  // clear button
  const buttons  = document.querySelectorAll('[data-filter="department"] .dropdown button');

  let active = '';

  function render() {
    sections.forEach(s => {
      const dept = s.dataset.dept;                 // "leadership" | "engineering" | "science" | "operations"
      s.hidden = !!active && dept !== active;       // hide sections that don't match
    });

    // chip UI
    chip.querySelector('.value').hidden  = !active;
    chip.querySelector('button').hidden  = !active;
    chip.querySelector('.value').innerHTML = active ? `<span>${active}</span>` : '';
    clearAll.hidden = !active;

    // highlight active in dropdown
    buttons.forEach(b => b.classList.toggle('active', b.textContent.toLowerCase() === active));
  }

  // open/close dropdown
  chip.addEventListener('click', e => {
    if (['span','div','i'].includes(e.target.localName)) {
      chip.querySelector('.dropdown').toggleAttribute('hidden');
      e.stopPropagation();
    }
  });
  document.addEventListener('click', () => chip.querySelector('.dropdown').hidden = true);
  // choose dept
  buttons.forEach(b => b.addEventListener('click', e => {
    active = e.target.textContent.toLowerCase();   // must match data-dept value
    chip.querySelector('.dropdown').hidden = true;
    render();
  }));

  // clear
  chip.querySelector('button').addEventListener('click', () => { active = ''; render(); });
  clearAll.addEventListener('click', () => { active = ''; render(); });

  render(); // initial draw
})();
</script>
{{end}}
